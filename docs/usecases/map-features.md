# 지도 기능 유스케이스 명세서

## 문서 정보

- **버전**: 1.0.0
- **최종 수정일**: 2025-10-21
- **작성자**: Development Team
- **문서 상태**: Draft
- **참조 문서**:
  - [사용자 플로우 문서](/docs/userflow.md)
  - [PRD](/docs/prd.md)

---

## 개요

본 문서는 맛집 지도 서비스의 지도 기능에 대한 상세 유스케이스를 정의합니다. 지도 기능은 사용자가 맛집을 시각적으로 탐색하고 위치 기반으로 정보를 확인할 수 있는 핵심 기능입니다.

### 포함된 유스케이스

1. **UC-MAP-001**: 지도 내비게이션 (드래그, 줌)
2. **UC-MAP-002**: 마커 표시 (카테고리별 아이콘)
3. **UC-MAP-003**: 마커 클러스터링
4. **UC-MAP-004**: 현재 위치로 이동

---

## UC-MAP-001: 지도 내비게이션

### 유스케이스 정보

- **유스케이스 ID**: UC-MAP-001
- **유스케이스 이름**: 지도 내비게이션 (드래그, 줌)
- **액터**: 사용자
- **우선순위**: P0 (Must)
- **복잡도**: 중간

### 설명

사용자가 지도를 드래그하여 이동하고 줌인/줌아웃하여 원하는 영역의 맛집 정보를 탐색할 수 있는 기능입니다. 지도 이동이 완료되면 보이는 영역의 리뷰가 있는 장소 정보를 동적으로 로딩합니다.

### 사전 조건

- 사용자가 홈 페이지("/")에 접속한 상태
- 네이버 지도 SDK가 정상적으로 로드된 상태
- 지도 컴포넌트가 초기화된 상태

### 기본 플로우

1. **지도 드래그 시작**
   - 사용자가 지도 영역에서 마우스 클릭(또는 터치)하고 드래그를 시작한다
   - 시스템은 드래그 이벤트를 감지한다
   - 지도 중심점이 드래그 방향에 따라 실시간으로 이동한다

2. **지도 드래그 완료**
   - 사용자가 마우스를 떼거나 터치를 종료한다
   - 시스템은 `idle` 이벤트를 감지한다
   - 시스템은 새로운 지도 영역의 경계(bounds)를 계산한다
   - 시스템은 디바운싱(300ms)을 적용하여 과도한 API 호출을 방지한다

3. **영역 기반 데이터 로딩**
   - 시스템은 현재 지도 영역의 남서쪽 좌표(lat1, lng1)와 북동쪽 좌표(lat2, lng2)를 추출한다
   - 시스템은 선택된 카테고리 필터 정보를 함께 포함한다
   - 시스템은 `GET /api/places` API를 호출한다
   - 서버는 해당 영역 내 리뷰가 있는 장소 목록을 반환한다
   - 시스템은 기존 마커를 제거한다
   - 시스템은 새로운 장소 데이터를 기반으로 마커를 렌더링한다

4. **줌 조작**
   - 사용자가 다음 중 하나의 방법으로 줌을 조작한다:
     - 마우스 휠 스크롤
     - 터치 핀치 제스처
     - 줌 컨트롤 버튼 클릭(+/-)
   - 시스템은 줌 레벨을 변경한다
   - 지도가 확대/축소된다
   - 줌 변경이 완료되면 2-3단계가 실행된다

5. **로딩 상태 표시**
   - API 호출 중 지도 영역에 로딩 스켈레톤 UI를 표시한다
   - 데이터 로딩이 완료되면 스켈레톤 UI를 제거하고 마커를 표시한다

### 대체 플로우

#### AF-001: 빠른 연속 드래그

- **조건**: 사용자가 지도를 빠르게 연속으로 드래그하는 경우
- **플로우**:
  1. 시스템은 디바운싱(300ms)을 적용한다
  2. 마지막 드래그가 완료된 후 300ms가 경과한 시점에만 API를 호출한다
  3. 중간 드래그 이벤트들은 무시된다

#### AF-002: 카테고리 필터 변경 중 드래그

- **조건**: 사용자가 지도를 드래그하는 동안 카테고리 필터를 변경하는 경우
- **플로우**:
  1. 시스템은 진행 중인 API 호출을 취소한다
  2. 새로운 카테고리 필터 정보를 포함하여 API를 재호출한다
  3. 변경된 카테고리에 해당하는 마커만 표시한다

#### AF-003: 마커 클릭 후 지도 복귀

- **조건**: 사용자가 마커를 클릭하여 장소 상세 페이지로 이동한 후 뒤로가기로 복귀하는 경우
- **플로우**:
  1. 시스템은 이전 지도 상태(중심점, 줌 레벨)를 복원한다
  2. 저장된 마커 데이터를 사용하여 즉시 렌더링한다
  3. 필요시 백그라운드에서 데이터를 갱신한다

### 예외 플로우

#### EF-001: 네트워크 에러

- **조건**: API 호출 중 네트워크 오류가 발생한 경우
- **플로우**:
  1. 시스템은 로딩 상태를 종료한다
  2. 시스템은 토스트 메시지를 표시한다: "네트워크 연결을 확인해주세요"
  3. 시스템은 재시도 버튼을 제공한다
  4. 사용자가 재시도 버튼을 클릭하면 API를 재호출한다
  5. 이전 마커 데이터가 있다면 계속 표시한다

#### EF-002: 서버 에러 (5xx)

- **조건**: API 호출 중 서버 오류가 발생한 경우
- **플로우**:
  1. 시스템은 로딩 상태를 종료한다
  2. 시스템은 토스트 메시지를 표시한다: "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요"
  3. 시스템은 자동으로 3초 후 재시도를 시도한다 (최대 3회)
  4. 3회 실패 시 재시도 버튼을 제공한다

#### EF-003: 빈 데이터

- **조건**: API 응답이 성공했지만 해당 영역에 장소 데이터가 없는 경우
- **플로우**:
  1. 시스템은 기존 마커를 모두 제거한다
  2. 시스템은 지도 중앙에 안내 메시지를 표시한다: "이 지역에는 아직 리뷰가 없습니다"
  3. 사용자가 지도를 이동하면 안내 메시지를 제거한다

#### EF-004: 지도 초기화 실패

- **조건**: 네이버 지도 SDK 로딩이 실패한 경우
- **플로우**:
  1. 시스템은 에러 페이지를 표시한다
  2. 시스템은 에러 메시지를 표시한다: "지도를 불러올 수 없습니다. 페이지를 새로고침해주세요"
  3. 시스템은 새로고침 버튼을 제공한다

### 사후 조건

- 지도가 새로운 위치로 이동된 상태
- 새로운 영역의 장소 마커가 표시된 상태
- 지도 중심점과 줌 레벨이 업데이트된 상태
- 사용자가 새로운 영역의 맛집 정보를 확인할 수 있는 상태

### 비기능 요구사항

#### 성능

- 지도 드래그 시 60fps 유지 (부드러운 스크롤)
- API 응답 시간 500ms 이내 (p95)
- 마커 렌더링 시간 500ms 이내 (100개 마커 기준)
- 디바운싱 시간 300ms

#### 사용성

- 터치 디바이스에서 핀치 줌 지원
- 마우스 휠 줌 지원
- 줌 컨트롤 버튼 크기 최소 44x44px (모바일)
- 드래그 관성(inertia) 효과 지원

#### 접근성

- 키보드로 지도 이동 가능 (화살표 키)
- 줌 컨트롤 버튼에 aria-label 제공
- 지도 영역에 role="application" 속성 제공

---

## UC-MAP-002: 마커 표시 (카테고리별 아이콘)

### 유스케이스 정보

- **유스케이스 ID**: UC-MAP-002
- **유스케이스 이름**: 마커 표시 (카테고리별 아이콘)
- **액터**: 사용자
- **우선순위**: P0 (Must)
- **복잡도**: 중간

### 설명

지도에 리뷰가 있는 장소를 시각적으로 표시하며, 각 장소의 카테고리에 따라 구분된 아이콘을 사용하여 사용자가 쉽게 식별할 수 있도록 합니다.

### 사전 조건

- 지도가 정상적으로 렌더링된 상태
- 장소 데이터가 API로부터 성공적으로 로드된 상태
- 각 장소에 카테고리 정보가 포함된 상태

### 기본 플로우

1. **장소 데이터 수신**
   - 시스템은 `GET /api/places` API로부터 장소 목록을 수신한다
   - 각 장소 데이터는 다음 정보를 포함한다:
     - id (장소 고유 ID)
     - name (장소명)
     - latitude, longitude (위도, 경도)
     - category (카테고리: 한식, 일식, 양식, 중식, 카페, 기타)
     - averageRating (평균 평점)
     - reviewCount (리뷰 수)

2. **마커 아이콘 선택**
   - 시스템은 각 장소의 카테고리를 확인한다
   - 시스템은 카테고리에 따라 적절한 아이콘을 선택한다:
     - 한식 → 밥 아이콘 (🍚)
     - 일식 → 초밥 아이콘 (🍣)
     - 양식 → 스테이크 아이콘 (🥩)
     - 중식 → 만두 아이콘 (🥟)
     - 카페/디저트 → 커피 아이콘 (☕)
     - 기타 → 기본 핀 아이콘 (📍)

3. **마커 생성 및 렌더링**
   - 시스템은 각 장소에 대해 네이버 지도 마커를 생성한다
   - 마커 속성을 설정한다:
     - position: { lat, lng }
     - icon: 카테고리별 아이콘 이미지
     - title: 장소명 (호버 시 표시)
     - zIndex: 평점 기반 우선순위 (높은 평점이 위에 표시)
   - 마커를 지도에 추가한다

4. **마커 인터랙션 설정**
   - 시스템은 각 마커에 클릭 이벤트 리스너를 등록한다
   - 마커 호버 시 커서를 포인터로 변경한다
   - 마커 호버 시 장소명 툴팁을 표시한다

5. **마커 클릭 처리**
   - 사용자가 마커를 클릭한다
   - 시스템은 해당 장소의 ID를 추출한다
   - 시스템은 장소 상세 페이지로 이동한다: `/place/[placeId]`

### 대체 플로우

#### AF-001: 카테고리 필터 적용

- **조건**: 사용자가 카테고리 필터를 선택한 경우
- **플로우**:
  1. 시스템은 선택된 카테고리 목록을 확인한다
  2. 시스템은 해당 카테고리의 마커만 렌더링한다
  3. 다른 카테고리의 마커는 지도에서 제거한다
  4. 필터 해제 시 모든 카테고리의 마커를 다시 표시한다

#### AF-002: 마커 중복 위치

- **조건**: 동일한 위치에 여러 장소가 있는 경우 (동일 건물 내 여러 맛집)
- **플로우**:
  1. 시스템은 중복 위치를 감지한다
  2. 시스템은 마커 위치를 약간씩(10-20m) 이동하여 겹치지 않게 배치한다
  3. 또는 클러스터로 그룹화한다 (UC-MAP-003 참조)

#### AF-003: 평점별 마커 강조

- **조건**: 높은 평점의 장소를 강조 표시하고자 하는 경우
- **플로우**:
  1. 시스템은 평점 4.5 이상의 장소를 확인한다
  2. 시스템은 해당 마커에 별 배지를 추가한다
  3. 시스템은 해당 마커의 zIndex를 높여 상위에 표시한다

### 예외 플로우

#### EF-001: 카테고리 정보 없음

- **조건**: 장소 데이터에 카테고리 정보가 없거나 null인 경우
- **플로우**:
  1. 시스템은 기본 핀 아이콘을 사용한다
  2. 시스템은 해당 장소를 "기타" 카테고리로 분류한다
  3. 로그에 경고 메시지를 기록한다

#### EF-002: 좌표 정보 오류

- **조건**: 위도/경도 정보가 유효하지 않은 경우 (null, 범위 초과 등)
- **플로우**:
  1. 시스템은 해당 장소의 마커를 생성하지 않는다
  2. 시스템은 콘솔에 에러 로그를 출력한다
  3. 시스템은 다음 장소로 진행한다

#### EF-003: 아이콘 이미지 로딩 실패

- **조건**: 카테고리별 아이콘 이미지 로딩이 실패한 경우
- **플로우**:
  1. 시스템은 기본 네이버 지도 마커를 사용한다
  2. 시스템은 마커 색상으로 카테고리를 구분한다
  3. 시스템은 백그라운드에서 아이콘 재로딩을 시도한다

#### EF-004: 과도한 마커 수

- **조건**: 현재 영역에 100개 이상의 마커가 표시되어야 하는 경우
- **플로우**:
  1. 시스템은 마커 클러스터링을 자동으로 활성화한다 (UC-MAP-003)
  2. 또는 평점 기준 상위 100개만 표시하고 안내 메시지를 표시한다
  3. 사용자에게 줌인을 유도하는 메시지를 표시한다

### 사후 조건

- 지도에 카테고리별로 구분된 아이콘 마커가 표시된 상태
- 각 마커가 클릭 가능한 상태
- 사용자가 시각적으로 카테고리를 구분할 수 있는 상태

### 비기능 요구사항

#### 성능

- 마커 렌더링 시간 500ms 이내 (100개 기준)
- 아이콘 이미지 크기 10KB 이하 (각 카테고리별)
- 아이콘 이미지 캐싱 적용

#### 사용성

- 마커 아이콘 크기 최소 32x32px (모바일)
- 마커 터치 영역 최소 44x44px
- 명확한 색상 대비 (배경과 최소 4.5:1)

#### 접근성

- 각 마커에 aria-label 제공: "[카테고리] [장소명] [평점]"
- 키보드 Tab으로 마커 간 이동 가능
- 스크린 리더가 마커 정보를 읽을 수 있도록 구조화

---

## UC-MAP-003: 마커 클러스터링

### 유스케이스 정보

- **유스케이스 ID**: UC-MAP-003
- **유스케이스 이름**: 마커 클러스터링
- **액터**: 사용자
- **우선순위**: P2 (Could)
- **복잡도**: 높음

### 설명

줌 레벨이 낮을 때(넓은 지역을 볼 때) 근접한 여러 마커를 그룹화하여 하나의 클러스터로 표시함으로써 지도 가독성을 높이고 성능을 최적화합니다.

### 사전 조건

- 지도가 정상적으로 렌더링된 상태
- 현재 영역에 여러 장소 마커가 존재하는 상태
- 마커 클러스터링 라이브러리가 로드된 상태

### 기본 플로우

1. **클러스터링 조건 확인**
   - 시스템은 현재 줌 레벨을 확인한다
   - 줌 레벨이 13 미만인 경우 클러스터링을 활성화한다
   - 줌 레벨이 13 이상인 경우 개별 마커를 표시한다

2. **근접 마커 그룹화**
   - 시스템은 지도에 표시된 모든 마커의 좌표를 분석한다
   - 시스템은 거리 기반 그룹핑 알고리즘을 적용한다:
     - 반경 100m 이내의 마커를 하나의 그룹으로 묶는다
     - 그룹 내 마커 개수를 계산한다
   - 2개 이상의 마커가 있는 그룹에 클러스터를 생성한다

3. **클러스터 마커 생성**
   - 시스템은 각 클러스터의 중심점을 계산한다
   - 시스템은 클러스터 마커를 생성한다:
     - 원형 아이콘 (배경: 파란색)
     - 중앙에 숫자 표시 (그룹 내 마커 개수)
     - 크기는 개수에 따라 조정:
       - 2-9개: 작은 원 (40x40px)
       - 10-99개: 중간 원 (50x50px)
       - 100개 이상: 큰 원 (60x60px)

4. **클러스터 렌더링**
   - 시스템은 개별 마커를 제거한다
   - 시스템은 클러스터 마커를 지도에 추가한다
   - 시스템은 클러스터 마커에 클릭 이벤트를 등록한다

5. **클러스터 클릭 처리**
   - 사용자가 클러스터 마커를 클릭한다
   - 시스템은 해당 클러스터 영역으로 줌인한다 (줌 레벨 +2)
   - 시스템은 클러스터를 분해하고 개별 마커를 표시한다
   - 필요시 새로운 하위 클러스터를 생성한다

6. **줌 변경 시 재클러스터링**
   - 사용자가 줌 레벨을 변경한다
   - 시스템은 새로운 줌 레벨에 따라 클러스터를 재계산한다
   - 시스템은 클러스터를 다시 렌더링한다

### 대체 플로우

#### AF-001: 소수 마커 (클러스터링 불필요)

- **조건**: 현재 영역에 마커가 10개 미만인 경우
- **플로우**:
  1. 시스템은 클러스터링을 비활성화한다
  2. 시스템은 모든 마커를 개별적으로 표시한다

#### AF-002: 카테고리별 클러스터링

- **조건**: 사용자가 특정 카테고리 필터를 선택한 경우
- **플로우**:
  1. 시스템은 선택된 카테고리의 마커만 클러스터링 대상으로 한다
  2. 시스템은 클러스터 색상을 카테고리 색상으로 변경한다
  3. 시스템은 클러스터 내 평균 평점을 계산하여 표시한다

#### AF-003: 클러스터 호버 인터랙션

- **조건**: 사용자가 클러스터 마커에 마우스를 올린 경우
- **플로우**:
  1. 시스템은 클러스터 마커를 확대한다 (1.2배)
  2. 시스템은 툴팁을 표시한다:
     - "이 지역에 [N]개의 맛집이 있습니다"
     - "클릭하면 확대됩니다"
  3. 마우스가 벗어나면 원래 크기로 복원한다

### 예외 플로우

#### EF-001: 클러스터링 라이브러리 로딩 실패

- **조건**: 마커 클러스터링 라이브러리 로딩이 실패한 경우
- **플로우**:
  1. 시스템은 클러스터링 없이 개별 마커만 표시한다
  2. 시스템은 콘솔에 경고 로그를 출력한다
  3. 마커가 과도하게 많은 경우 상위 100개만 표시한다

#### EF-002: 클러스터 계산 시간 초과

- **조건**: 마커가 너무 많아 클러스터 계산이 3초 이상 소요되는 경우
- **플로우**:
  1. 시스템은 계산을 중단한다
  2. 시스템은 간소화된 그리드 기반 클러스터링을 적용한다
  3. 시스템은 성능 경고를 로그에 기록한다

#### EF-003: 빈 클러스터

- **조건**: 클러스터 계산 결과 마커가 없는 클러스터가 생성된 경우
- **플로우**:
  1. 시스템은 해당 클러스터를 제거한다
  2. 시스템은 클러스터링 알고리즘을 재실행한다

### 사후 조건

- 줌 레벨이 낮을 때 근접 마커가 클러스터로 그룹화된 상태
- 클러스터 마커에 그룹 내 마커 개수가 표시된 상태
- 사용자가 클러스터를 클릭하여 확대할 수 있는 상태
- 지도 성능이 최적화된 상태

### 비기능 요구사항

#### 성능

- 클러스터 계산 시간 500ms 이내 (1000개 마커 기준)
- 줌 변경 시 재클러스터링 300ms 이내
- 클러스터 렌더링 시 60fps 유지

#### 사용성

- 클러스터 마커 터치 영역 최소 44x44px
- 클러스터 색상이 배경과 명확하게 구분
- 클러스터 내 숫자가 읽기 쉬운 크기 (최소 14px)

#### 확장성

- 최대 5000개 마커까지 클러스터링 지원
- 다양한 줌 레벨에서 동작
- 다양한 화면 크기에서 동작

---

## UC-MAP-004: 현재 위치로 이동

### 유스케이스 정보

- **유스케이스 ID**: UC-MAP-004
- **유스케이스 이름**: 현재 위치로 이동
- **액터**: 사용자
- **우선순위**: P0 (Must)
- **복잡도**: 낮음

### 설명

사용자가 버튼 클릭 한 번으로 현재 위치를 중심으로 지도를 이동하여 주변 맛집을 빠르게 탐색할 수 있는 기능입니다.

### 사전 조건

- 지도가 정상적으로 렌더링된 상태
- 현재 위치 버튼이 표시된 상태 (우측 하단 플로팅 버튼)
- 브라우저가 Geolocation API를 지원하는 상태

### 기본 플로우

1. **현재 위치 버튼 클릭**
   - 사용자가 지도 우측 하단의 현재 위치 버튼을 클릭한다
   - 버튼 아이콘: 타겟 또는 GPS 모양
   - 시스템은 버튼을 비활성화하고 로딩 상태로 변경한다 (스피너 표시)

2. **위치 권한 확인**
   - 시스템은 브라우저 Geolocation API를 사용하여 위치 권한 상태를 확인한다
   - 권한 상태를 확인한다:
     - "granted" (허용됨)
     - "prompt" (묻기)
     - "denied" (거부됨)

3. **위치 권한 요청 (최초 또는 prompt 상태)**
   - 시스템이 위치 권한이 없거나 prompt 상태인 경우
   - 시스템은 브라우저 권한 요청 팝업을 표시한다
   - 메시지: "현재 위치를 확인하려면 위치 권한을 허용해주세요"
   - 사용자가 "허용" 또는 "차단"을 선택한다

4. **현재 위치 좌표 획득**
   - 위치 권한이 허용된 경우
   - 시스템은 `navigator.geolocation.getCurrentPosition()`을 호출한다
   - 시스템은 현재 위치의 위도(latitude)와 경도(longitude)를 받는다
   - 정확도(accuracy) 정보도 함께 받는다

5. **지도 이동 및 마커 표시**
   - 시스템은 획득한 좌표를 지도 중심으로 설정한다
   - 시스템은 부드러운 애니메이션과 함께 지도를 이동한다 (duration: 500ms)
   - 시스템은 줌 레벨을 15로 설정한다
   - 시스템은 현재 위치에 특별한 마커를 표시한다:
     - 아이콘: 파란색 점 + 반투명 원형 테두리
     - 펄스(pulse) 애니메이션 효과
   - 시스템은 해당 영역의 맛집 마커를 로딩한다 (UC-MAP-001)

6. **버튼 상태 복원**
   - 시스템은 현재 위치 버튼을 활성화 상태로 복원한다
   - 로딩 스피너를 제거하고 원래 아이콘을 표시한다
   - 토스트 메시지를 표시한다: "현재 위치로 이동했습니다"

### 대체 플로우

#### AF-001: 이미 현재 위치에 있는 경우

- **조건**: 사용자가 이미 현재 위치 근처(반경 500m 이내)에 있는 경우
- **플로우**:
  1. 시스템은 현재 위치를 다시 확인한다
  2. 시스템은 미세 조정하여 정확한 위치로 이동한다
  3. 시스템은 토스트 메시지를 표시한다: "이미 현재 위치 근처입니다"
  4. 시스템은 주변 맛집 마커를 새로고침한다

#### AF-002: 캐시된 위치 사용

- **조건**: 최근(5분 이내)에 위치를 조회한 적이 있는 경우
- **플로우**:
  1. 시스템은 캐시된 위치 정보를 사용한다
  2. 시스템은 즉시 지도를 이동한다 (API 호출 생략)
  3. 백그라운드에서 위치를 갱신한다
  4. 위치 변화가 100m 이상인 경우에만 지도를 다시 이동한다

#### AF-003: 실내 위치

- **조건**: 사용자가 실내에 있어 GPS 정확도가 낮은 경우 (accuracy > 100m)
- **플로우**:
  1. 시스템은 낮은 정확도를 감지한다
  2. 시스템은 지도를 이동하되 줌 레벨을 낮춘다 (13)
  3. 시스템은 토스트 메시지를 표시한다: "현재 위치 정확도가 낮습니다. 대략적인 위치입니다"
  4. 현재 위치 마커에 넓은 반투명 원을 표시하여 오차 범위를 나타낸다

### 예외 플로우

#### EF-001: 위치 권한 거부

- **조건**: 사용자가 위치 권한을 거부한 경우
- **플로우**:
  1. 시스템은 권한 거부를 감지한다
  2. 시스템은 로딩 상태를 종료하고 버튼을 활성화한다
  3. 시스템은 토스트 메시지를 표시한다: "위치 권한이 필요합니다. 브라우저 설정에서 권한을 허용해주세요"
  4. 시스템은 기본 위치(서울시청)를 유지한다
  5. 선택적으로 권한 설정 안내 다이얼로그를 표시한다

#### EF-002: 위치 정보 획득 실패

- **조건**: Geolocation API 호출이 실패한 경우 (타임아웃, 위치 정보 없음 등)
- **플로우**:
  1. 시스템은 에러를 감지한다
  2. 시스템은 로딩 상태를 종료하고 버튼을 활성화한다
  3. 시스템은 토스트 메시지를 표시한다: "위치를 가져올 수 없습니다. 다시 시도해주세요"
  4. 시스템은 재시도 버튼을 제공한다 (토스트 메시지 내)

#### EF-003: Geolocation API 미지원

- **조건**: 브라우저가 Geolocation API를 지원하지 않는 경우
- **플로우**:
  1. 시스템은 페이지 로딩 시 API 지원 여부를 확인한다
  2. 미지원 시 현재 위치 버튼을 숨기거나 비활성화한다
  3. 버튼 클릭 시 토스트 메시지를 표시한다: "이 브라우저는 위치 기능을 지원하지 않습니다"

#### EF-004: 위치 획득 타임아웃

- **조건**: 위치 정보 획득이 10초 이상 소요되는 경우
- **플로우**:
  1. 시스템은 타임아웃을 감지한다
  2. 시스템은 로딩 상태를 종료한다
  3. 시스템은 토스트 메시지를 표시한다: "위치 확인 시간이 초과되었습니다. 다시 시도해주세요"
  4. 시스템은 에러를 로그에 기록한다

#### EF-005: 네트워크 오프라인

- **조건**: 사용자가 오프라인 상태인 경우
- **플로우**:
  1. 시스템은 네트워크 상태를 확인한다
  2. 시스템은 위치는 획득하지만 지도 타일 로딩이 실패한다
  3. 시스템은 토스트 메시지를 표시한다: "네트워크 연결을 확인해주세요"
  4. 위치 좌표는 저장하고 온라인 복귀 시 자동으로 이동한다

### 사후 조건

- 지도가 사용자의 현재 위치를 중심으로 이동된 상태
- 현재 위치 마커가 표시된 상태
- 주변 맛집 마커가 로딩된 상태
- 사용자가 주변 맛집 정보를 확인할 수 있는 상태

### 비기능 요구사항

#### 성능

- 위치 획득 시간 3초 이내
- 지도 이동 애니메이션 500ms
- 버튼 응답 시간 100ms 이내
- 위치 정보 캐시 유효 시간 5분

#### 사용성

- 버튼 크기 최소 56x56px (플로팅 버튼)
- 버튼 터치 영역 충분히 확보 (우측 하단, 필터바와 겹치지 않음)
- 명확한 로딩 상태 표시
- 위치 권한 안내 메시지 명확

#### 접근성

- 버튼에 aria-label 제공: "내 위치로 이동"
- 로딩 상태에 aria-busy="true" 설정
- 키보드로 버튼 활성화 가능 (Space/Enter)
- 현재 위치 마커에 alt 텍스트 제공

#### 보안

- HTTPS 환경에서만 Geolocation API 작동
- 위치 정보를 서버에 저장하지 않음 (클라이언트만 사용)
- 위치 권한 요청 시 명확한 사용 목적 안내

---

## 부록

### A. 용어집

| 용어 | 설명 |
|------|------|
| 마커 (Marker) | 지도 위에 특정 위치를 표시하는 시각적 요소 |
| 클러스터 (Cluster) | 근접한 여러 마커를 하나의 그룹으로 묶은 것 |
| 줌 레벨 (Zoom Level) | 지도의 확대/축소 정도 (1-21, 높을수록 확대) |
| 바운드 (Bounds) | 지도에 보이는 영역의 경계 좌표 |
| Geolocation API | 브라우저에서 제공하는 위치 정보 API |
| 디바운싱 (Debouncing) | 연속된 이벤트 발생 시 마지막 이벤트만 처리하는 기법 |

### B. 관련 API 엔드포인트

| 엔드포인트 | 메서드 | 설명 |
|-----------|--------|------|
| `/api/places` | GET | 지도 영역 내 장소 목록 조회 |
| `/api/places/:id` | GET | 장소 상세 정보 조회 |

### C. 참조 컴포넌트

| 컴포넌트 경로 | 설명 |
|-------------|------|
| `src/components/map/NaverMap.tsx` | 네이버 지도 메인 컴포넌트 |
| `src/components/map/MapMarker.tsx` | 개별 마커 컴포넌트 |
| `src/components/map/MarkerCluster.tsx` | 마커 클러스터 컴포넌트 |
| `src/components/map/CurrentLocationButton.tsx` | 현재 위치 버튼 컴포넌트 |
| `src/components/map/CategoryFilter.tsx` | 카테고리 필터 컴포넌트 |

### D. 상태 관리 스토어

```typescript
// src/stores/mapStore.ts
interface MapState {
  center: { lat: number; lng: number };
  zoom: number;
  selectedCategory: string[];
  currentLocation: { lat: number; lng: number } | null;

  setCenter: (center: { lat: number; lng: number }) => void;
  setZoom: (zoom: number) => void;
  toggleCategory: (category: string) => void;
  setCurrentLocation: (location: { lat: number; lng: number } | null) => void;
}
```

### E. 테스트 케이스 요약

| 유스케이스 | 테스트 케이스 수 | 우선순위 |
|-----------|----------------|---------|
| UC-MAP-001 | 12 | P0 |
| UC-MAP-002 | 10 | P0 |
| UC-MAP-003 | 8 | P2 |
| UC-MAP-004 | 11 | P0 |

### F. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0.0 | 2025-10-21 | Development Team | 초안 작성 |

---

**문서 끝**
