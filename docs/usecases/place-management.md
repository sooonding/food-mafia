# 장소 관리 기능 유스케이스

## 문서 정보

- **버전**: 1.0.0
- **최종 수정일**: 2025-10-21
- **작성자**: Development Team
- **관련 문서**:
  - [사용자 플로우](/docs/userflow.md) - 섹션 7.3 장소 관리
  - [PRD](/docs/prd.md) - 섹션 3.2.1 지도 및 장소 관리

---

## 개요

이 문서는 맛집 지도 서비스의 장소 관리 기능에 대한 상세 유스케이스를 정의합니다. 장소 관리 기능은 사용자가 맛집 정보를 조회하고, 즐겨찾기에 추가/제거하며, 저장된 장소 목록을 관리할 수 있도록 지원합니다.

---

## 유스케이스 목록

1. [UC-PLACE-001: 장소 상세 정보 조회](#uc-place-001-장소-상세-정보-조회)
2. [UC-PLACE-002: 장소 즐겨찾기 추가](#uc-place-002-장소-즐겨찾기-추가)
3. [UC-PLACE-003: 장소 즐겨찾기 제거](#uc-place-003-장소-즐겨찾기-제거)
4. [UC-PLACE-004: 즐겨찾기 목록 조회](#uc-place-004-즐겨찾기-목록-조회)

---

## UC-PLACE-001: 장소 상세 정보 조회

### 기본 정보

- **유스케이스 ID**: UC-PLACE-001
- **유스케이스 이름**: 장소 상세 정보 조회
- **우선순위**: P0 (Must Have)
- **관련 기능**: FR-MAP-002 (마커 표시), FR-SEARCH-002 (검색 결과 표시)

### 액터

- **주요 액터**: 사용자 (비로그인)
- **보조 액터**:
  - Supabase 데이터베이스
  - Hono 백엔드 API

### 사전 조건

1. 사용자가 장소 상세 페이지(`/place/[placeId]`)에 접근
2. 해당 장소가 데이터베이스에 존재
3. 네트워크 연결이 정상적으로 동작

### 사후 조건

**성공 시:**
- 장소의 상세 정보가 화면에 표시됨
- 해당 장소의 리뷰 목록이 로딩됨 (첫 페이지, 최신순 기본)
- 평균 평점 및 리뷰 수가 계산되어 표시됨
- 즐겨찾기 버튼의 상태가 현재 즐겨찾기 여부를 반영함

**실패 시:**
- 에러 페이지 또는 에러 메시지 표시
- 사용자는 이전 페이지로 돌아갈 수 있음

### 기본 플로우

1. 사용자가 다음 중 하나의 방법으로 장소 상세 페이지에 진입
   - 홈 페이지 지도에서 마커 클릭
   - 검색 결과에서 장소 선택
   - 즐겨찾기 목록에서 장소 선택
   - 직접 URL 입력

2. 시스템이 페이지 로딩 시작
   - 스켈레톤 UI 표시
   - 로딩 인디케이터 표시

3. 시스템이 장소 ID로 장소 정보 조회 API 호출
   ```
   GET /api/places/:placeId
   ```

4. 백엔드가 Supabase에서 장소 데이터 조회
   - `places` 테이블에서 해당 ID의 레코드 검색
   - 평균 평점(`average_rating`) 및 리뷰 수(`review_count`) 포함

5. 시스템이 장소의 리뷰 목록 조회 API 호출
   ```
   GET /api/places/:placeId/reviews?page=1&limit=20&sort=latest
   ```

6. 백엔드가 Supabase에서 리뷰 데이터 조회
   - `reviews` 테이블에서 해당 `place_id`의 리뷰 검색
   - 최신순 정렬 적용
   - 첫 20개 리뷰 반환

7. 시스템이 로컬 스토리지에서 즐겨찾기 목록 확인
   - `mafia-favorites` 키로 저장된 데이터 로드
   - 현재 장소가 즐겨찾기에 포함되어 있는지 확인

8. 시스템이 페이지 렌더링
   - **장소 정보 섹션** 표시:
     - 장소명 (H1)
     - 도로명 주소
     - 카테고리 (한식, 일식 등)
     - 평균 평점 (별점 시각화, 예: ★★★★☆ 4.5)
     - 리뷰 수 (예: "리뷰 12개")

   - **액션 버튼 영역** 표시:
     - 리뷰 작성 버튼
     - 즐겨찾기 버튼 (현재 상태 반영: 채워진 하트/빈 하트)
     - 길찾기 버튼 (선택 사항)
     - 공유 버튼 (선택 사항)
     - 뒤로가기 버튼

   - **리뷰 목록 섹션** 표시:
     - 정렬 옵션 (최신순, 평점순)
     - 리뷰 카드 목록

9. 사용자가 장소 정보 및 리뷰 확인

### 대체 플로우

**AF-001: 지도 마커에서 진입**
- 1a. 사용자가 홈 페이지 지도에서 마커 클릭
- 1b. 시스템이 해당 장소의 `placeId` 획득
- 1c. 시스템이 장소 상세 페이지로 이동 (`/place/[placeId]`)
- 1d. 기본 플로우 2단계로 복귀

**AF-002: 검색 결과에서 진입**
- 1a. 사용자가 검색 결과 항목 클릭
- 1b. 시스템이 검색어를 최근 검색어에 추가 (로컬 스토리지)
- 1c. 시스템이 지도를 해당 위치로 이동
- 1d. 시스템이 해당 장소 마커 강조 표시
- 1e. 시스템이 장소 상세 페이지로 이동
- 1f. 검색 모달/드로어 닫기
- 1g. 기본 플로우 2단계로 복귀

**AF-003: 즐겨찾기 목록에서 진입**
- 1a. 사용자가 즐겨찾기 페이지(`/my-places`)에서 장소 카드 클릭
- 1b. 시스템이 장소 상세 페이지로 이동
- 1c. 기본 플로우 2단계로 복귀

**AF-004: 리뷰가 없는 장소**
- 6a. 백엔드가 리뷰 데이터 조회 시 결과가 0건
- 6b. 시스템이 빈 상태 UI 표시
  - "아직 리뷰가 없습니다. 첫 번째 리뷰를 작성해보세요!"
  - 리뷰 작성 버튼 강조 (CTA)
- 6c. 기본 플로우 7단계로 복귀

### 예외 플로우

**EF-001: 장소가 존재하지 않음**
- 4a. 백엔드가 해당 `placeId`를 데이터베이스에서 찾지 못함
- 4b. 백엔드가 404 에러 응답 반환
  ```json
  {
    "success": false,
    "error": {
      "code": "PLACE_NOT_FOUND",
      "message": "장소를 찾을 수 없습니다."
    }
  }
  ```
- 4c. 시스템이 에러 페이지 표시
  - "장소를 찾을 수 없습니다" 메시지
  - 홈으로 돌아가기 버튼
- 4d. 유스케이스 종료

**EF-002: 네트워크 에러**
- 3a. API 호출 중 네트워크 에러 발생
- 3b. 시스템이 에러 토스트 메시지 표시
  - "네트워크 연결을 확인해주세요"
- 3c. 시스템이 재시도 버튼 제공
- 3d. 사용자가 재시도 버튼 클릭 시 기본 플로우 3단계로 복귀

**EF-003: 서버 에러 (5xx)**
- 3a. 백엔드에서 내부 서버 에러 발생
- 3b. 백엔드가 500 에러 응답 반환
- 3c. 시스템이 에러 토스트 메시지 표시
  - "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요"
- 3d. 시스템이 재시도 버튼 제공
- 3e. 유스케이스 종료

**EF-004: 타임아웃**
- 3a. API 호출이 설정된 시간(10초) 내에 응답하지 않음
- 3b. 시스템이 요청 취소
- 3c. 시스템이 에러 토스트 메시지 표시
  - "요청 시간이 초과되었습니다. 다시 시도해주세요"
- 3d. 시스템이 재시도 버튼 제공
- 3e. 유스케이스 종료

### 비기능 요구사항

1. **성능**
   - 장소 정보 로딩 시간: < 500ms (p95)
   - 스켈레톤 UI는 즉시 표시되어야 함
   - 리뷰 목록은 무한 스크롤로 로딩 (20개씩)

2. **사용성**
   - 모바일/데스크톱 반응형 레이아웃 제공
   - 뒤로가기 버튼으로 이전 페이지 복귀 가능
   - 로딩 중에도 페이지 레이아웃은 유지됨

3. **접근성**
   - 모든 텍스트는 4.5:1 이상의 대비율 유지 (WCAG AA)
   - 별점은 시각적 표현과 함께 숫자로도 표시
   - 버튼에 적절한 aria-label 속성 제공

4. **보안**
   - 장소 ID는 UUID 형식으로 예측 불가능하게 생성
   - XSS 방지를 위해 모든 사용자 입력 데이터는 이스케이프 처리

---

## UC-PLACE-002: 장소 즐겨찾기 추가

### 기본 정보

- **유스케이스 ID**: UC-PLACE-002
- **유스케이스 이름**: 장소 즐겨찾기 추가
- **우선순위**: P1 (Should Have)
- **관련 기능**: FR-FAVORITE-001 (즐겨찾기 추가/제거)

### 액터

- **주요 액터**: 사용자 (비로그인)
- **보조 액터**:
  - 브라우저 로컬 스토리지

### 사전 조건

1. 사용자가 장소 상세 페이지에 있음
2. 해당 장소가 아직 즐겨찾기에 추가되지 않음 (빈 하트 아이콘 표시)
3. 브라우저가 로컬 스토리지를 지원함

### 사후 조건

**성공 시:**
- 장소가 로컬 스토리지의 즐겨찾기 목록에 추가됨
- 즐겨찾기 버튼이 채워진 하트 아이콘으로 변경됨
- 토스트 메시지 표시: "즐겨찾기에 추가되었습니다"
- 즐겨찾기 페이지(`/my-places`)에서 해당 장소 확인 가능

**실패 시:**
- 즐겨찾기 상태가 변경되지 않음
- 에러 토스트 메시지 표시

### 기본 플로우

1. 사용자가 장소 상세 페이지에서 즐겨찾기 버튼(빈 하트 아이콘) 클릭

2. 시스템이 로컬 스토리지에서 현재 즐겨찾기 목록 로드
   ```javascript
   const favorites = JSON.parse(localStorage.getItem('mafia-favorites') || '[]');
   ```

3. 시스템이 현재 장소가 즐겨찾기 목록에 있는지 확인
   - `placeId`로 중복 검사 수행

4. 시스템이 새로운 즐겨찾기 항목 생성
   ```javascript
   const newFavorite = {
     placeId: 'uuid-string',
     placeName: '맛있는 한식당',
     category: '한식',
     averageRating: 4.5,
     addedAt: new Date().toISOString()
   };
   ```

5. 시스템이 즐겨찾기 목록에 새 항목 추가
   ```javascript
   favorites.push(newFavorite);
   ```

6. 시스템이 용량 제한 확인
   - 즐겨찾기 목록이 100개를 초과하는지 검사

7. 시스템이 업데이트된 목록을 로컬 스토리지에 저장
   ```javascript
   localStorage.setItem('mafia-favorites', JSON.stringify(favorites));
   ```

8. 시스템이 UI 업데이트
   - 즐겨찾기 버튼 아이콘을 채워진 하트로 변경
   - 버튼 색상 변경 (예: 빨간색)

9. 시스템이 성공 토스트 메시지 표시
   - "즐겨찾기에 추가되었습니다" (3초간 표시)

### 대체 플로우

**AF-001: 즐겨찾기 목록이 비어있음**
- 2a. 로컬 스토리지에 `mafia-favorites` 키가 존재하지 않음
- 2b. 시스템이 빈 배열로 초기화
- 2c. 기본 플로우 3단계로 복귀

**AF-002: 즐겨찾기 목록이 100개 도달**
- 6a. 현재 즐겨찾기 목록이 이미 100개
- 6b. 시스템이 가장 오래된 항목 제거 (FIFO)
  - `addedAt` 날짜가 가장 오래된 항목 삭제
- 6c. 시스템이 안내 토스트 메시지 표시
  - "즐겨찾기가 100개를 초과하여 가장 오래된 항목이 제거되었습니다"
- 6d. 기본 플로우 7단계로 복귀

### 예외 플로우

**EF-001: 로컬 스토리지 비지원**
- 2a. 브라우저가 로컬 스토리지를 지원하지 않음 (예: 사생활 보호 모드)
- 2b. 시스템이 에러 토스트 메시지 표시
  - "즐겨찾기 기능을 사용할 수 없습니다. 브라우저 설정을 확인해주세요"
- 2c. 유스케이스 종료

**EF-002: 로컬 스토리지 용량 초과**
- 7a. 로컬 스토리지 저장 중 용량 초과 에러 발생 (QuotaExceededError)
- 7b. 시스템이 에러 토스트 메시지 표시
  - "저장 공간이 부족합니다. 일부 즐겨찾기를 삭제해주세요"
- 7c. 유스케이스 종료

**EF-003: 이미 즐겨찾기에 추가됨**
- 3a. 현재 장소가 이미 즐겨찾기 목록에 존재
- 3b. 시스템이 경고 토스트 메시지 표시
  - "이미 즐겨찾기에 추가된 장소입니다"
- 3c. 유스케이스 종료

### 비기능 요구사항

1. **성능**
   - 즐겨찾기 추가 동작은 100ms 이내에 완료되어야 함
   - 버튼 상태 변경은 즉각적으로 반영됨

2. **사용성**
   - 버튼 클릭 시 시각적 피드백 제공 (애니메이션)
   - 토스트 메시지는 자동으로 사라짐 (3초 후)

3. **데이터 무결성**
   - 동일한 장소가 중복으로 추가되지 않도록 방지
   - 로컬 스토리지 데이터는 JSON 형식으로 저장되어 파싱 가능해야 함

4. **제약사항**
   - 최대 100개의 즐겨찾기 제한
   - 로컬 스토리지 크기 제한 고려 (약 5-10MB)

---

## UC-PLACE-003: 장소 즐겨찾기 제거

### 기본 정보

- **유스케이스 ID**: UC-PLACE-003
- **유스케이스 이름**: 장소 즐겨찾기 제거
- **우선순위**: P1 (Should Have)
- **관련 기능**: FR-FAVORITE-001 (즐겨찾기 추가/제거)

### 액터

- **주요 액터**: 사용자 (비로그인)
- **보조 액터**:
  - 브라우저 로컬 스토리지

### 사전 조건

1. 사용자가 장소 상세 페이지 또는 즐겨찾기 목록 페이지에 있음
2. 해당 장소가 이미 즐겨찾기에 추가되어 있음 (채워진 하트 아이콘 표시)
3. 브라우저가 로컬 스토리지를 지원함

### 사후 조건

**성공 시:**
- 장소가 로컬 스토리지의 즐겨찾기 목록에서 제거됨
- 즐겨찾기 버튼이 빈 하트 아이콘으로 변경됨 (장소 상세 페이지의 경우)
- 장소 카드가 목록에서 제거됨 (즐겨찾기 목록 페이지의 경우)
- 토스트 메시지 표시: "즐겨찾기에서 제거되었습니다"

**실패 시:**
- 즐겨찾기 상태가 변경되지 않음
- 에러 토스트 메시지 표시

### 기본 플로우

**시나리오 A: 장소 상세 페이지에서 제거**

1. 사용자가 장소 상세 페이지에서 즐겨찾기 버튼(채워진 하트 아이콘) 클릭

2. 시스템이 로컬 스토리지에서 현재 즐겨찾기 목록 로드
   ```javascript
   const favorites = JSON.parse(localStorage.getItem('mafia-favorites') || '[]');
   ```

3. 시스템이 현재 장소가 즐겨찾기 목록에 있는지 확인
   - `placeId`로 검색

4. 시스템이 해당 장소를 즐겨찾기 목록에서 제거
   ```javascript
   const updatedFavorites = favorites.filter(fav => fav.placeId !== currentPlaceId);
   ```

5. 시스템이 업데이트된 목록을 로컬 스토리지에 저장
   ```javascript
   localStorage.setItem('mafia-favorites', JSON.stringify(updatedFavorites));
   ```

6. 시스템이 UI 업데이트
   - 즐겨찾기 버튼 아이콘을 빈 하트로 변경
   - 버튼 색상 변경 (예: 회색)

7. 시스템이 성공 토스트 메시지 표시
   - "즐겨찾기에서 제거되었습니다" (3초간 표시)

**시나리오 B: 즐겨찾기 목록 페이지에서 제거**

1. 사용자가 즐겨찾기 목록 페이지(`/my-places`)에서 장소 카드의 즐겨찾기 제거 버튼 클릭

2. 시스템이 확인 다이얼로그 표시 (선택 사항)
   - "이 장소를 즐겨찾기에서 제거하시겠습니까?"
   - [취소] [제거] 버튼

3. 사용자가 [제거] 버튼 클릭

4. 시스템이 로컬 스토리지에서 현재 즐겨찾기 목록 로드

5. 시스템이 해당 장소를 즐겨찾기 목록에서 제거

6. 시스템이 업데이트된 목록을 로컬 스토리지에 저장

7. 시스템이 UI 업데이트
   - 장소 카드를 목록에서 제거 (페이드 아웃 애니메이션)
   - 미니 지도에서 해당 마커 제거
   - 목록 카운트 업데이트 (예: "저장한 장소 (11개)")

8. 시스템이 성공 토스트 메시지 표시
   - "즐겨찾기에서 제거되었습니다"

9. 시스템이 즐겨찾기 목록이 비어있는지 확인
   - 목록이 비어있으면 빈 상태 UI 표시
     - "아직 즐겨찾기한 장소가 없습니다"
     - 홈으로 이동 버튼 CTA

### 대체 플로우

**AF-001: 확인 다이얼로그 없이 즉시 제거**
- 2a. 시스템 설정에서 확인 다이얼로그 생략 옵션이 활성화됨
- 2b. 확인 없이 즉시 제거 수행
- 2c. 기본 플로우 4단계로 복귀

**AF-002: 마지막 즐겨찾기 항목 제거**
- 7a. 제거 후 즐겨찾기 목록이 빈 배열이 됨
- 7b. 시스템이 빈 상태 UI 표시
  - "아직 즐겨찾기한 장소가 없습니다"
  - 홈으로 이동 버튼
- 7c. 기본 플로우 8단계로 복귀

### 예외 플로우

**EF-001: 로컬 스토리지 비지원**
- 2a. 브라우저가 로컬 스토리지를 지원하지 않음
- 2b. 시스템이 에러 토스트 메시지 표시
  - "즐겨찾기 기능을 사용할 수 없습니다. 브라우저 설정을 확인해주세요"
- 2c. 유스케이스 종료

**EF-002: 장소가 즐겨찾기에 없음**
- 3a. 현재 장소가 즐겨찾기 목록에 존재하지 않음
- 3b. 시스템이 경고 토스트 메시지 표시
  - "즐겨찾기에 없는 장소입니다"
- 3c. 버튼 상태를 빈 하트로 업데이트 (동기화)
- 3d. 유스케이스 종료

**EF-003: 로컬 스토리지 데이터 손상**
- 2a. 로컬 스토리지 데이터 파싱 중 에러 발생 (JSON.parse 실패)
- 2b. 시스템이 로컬 스토리지 초기화 (빈 배열)
- 2c. 시스템이 경고 토스트 메시지 표시
  - "즐겨찾기 데이터가 손상되어 초기화되었습니다"
- 2d. 유스케이스 종료

### 비기능 요구사항

1. **성능**
   - 즐겨찾기 제거 동작은 100ms 이내에 완료되어야 함
   - UI 업데이트는 부드러운 애니메이션과 함께 제공 (200-300ms)

2. **사용성**
   - 실수로 제거를 방지하기 위해 확인 다이얼로그 제공 (선택 사항)
   - 제거 후 Undo(실행 취소) 기능은 v1에서 제공하지 않음

3. **일관성**
   - 장소 상세 페이지와 즐겨찾기 목록 페이지의 즐겨찾기 상태는 실시간 동기화됨
   - 한 페이지에서 제거 시 다른 페이지에서도 즉시 반영됨

---

## UC-PLACE-004: 즐겨찾기 목록 조회

### 기본 정보

- **유스케이스 ID**: UC-PLACE-004
- **유스케이스 이름**: 즐겨찾기 목록 조회
- **우선순위**: P1 (Should Have)
- **관련 기능**: FR-FAVORITE-002 (즐겨찾기 목록)

### 액터

- **주요 액터**: 사용자 (비로그인)
- **보조 액터**:
  - 브라우저 로컬 스토리지
  - Supabase 데이터베이스
  - Hono 백엔드 API

### 사전 조건

1. 사용자가 즐겨찾기 목록 페이지(`/my-places`)에 접근
2. 브라우저가 로컬 스토리지를 지원함
3. 네트워크 연결이 정상적으로 동작

### 사후 조건

**성공 시:**
- 즐겨찾기한 장소 목록이 화면에 표시됨
- 각 장소의 최신 정보(평균 평점, 리뷰 수)가 표시됨
- 미니 지도에 즐겨찾기 장소 마커가 표시됨
- 사용자는 장소 카드 클릭으로 상세 페이지로 이동 가능
- 사용자는 목록에서 직접 즐겨찾기 제거 가능

**실패 시:**
- 에러 메시지 표시
- 빈 상태 UI 표시 (즐겨찾기 없음)

### 기본 플로우

1. 사용자가 헤더 또는 네비게이션에서 "즐겨찾기" 메뉴 클릭

2. 시스템이 즐겨찾기 목록 페이지(`/my-places`)로 이동

3. 시스템이 페이지 로딩 시작
   - 스켈레톤 UI 표시
   - 미니 지도 로딩 인디케이터 표시

4. 시스템이 로컬 스토리지에서 즐겨찾기 목록 로드
   ```javascript
   const favorites = JSON.parse(localStorage.getItem('mafia-favorites') || '[]');
   ```

5. 시스템이 각 즐겨찾기 장소의 최신 정보 조회
   - 각 `placeId`에 대해 병렬로 API 호출
   ```
   GET /api/places/:placeId
   ```

6. 백엔드가 Supabase에서 장소 데이터 조회
   - 장소명, 주소, 카테고리, 평균 평점, 리뷰 수, 위도/경도

7. 시스템이 조회된 데이터와 로컬 스토리지 데이터를 병합
   ```javascript
   const enrichedFavorites = favorites.map(fav => ({
     ...fav,
     ...fetchedPlaceData[fav.placeId]
   }));
   ```

8. 시스템이 페이지 렌더링

   **헤더 섹션:**
   - 제목: "즐겨찾기"
   - 저장한 장소 개수 (예: "저장한 장소 (12개)")

   **미니 지도 섹션:**
   - 모든 즐겨찾기 장소의 마커 표시
   - 카테고리별 아이콘 구분
   - 마커 클릭 시 해당 장소 상세 페이지로 이동
   - 지도 범위는 모든 마커를 포함하도록 자동 조정

   **장소 리스트 섹션:**
   - 즐겨찾기 장소 카드 목록 (스크롤 가능)
   - 각 카드 구성:
     - 장소명
     - 도로명 주소
     - 카테고리 태그
     - 평균 평점 (별점 시각화)
     - 리뷰 수
     - 즐겨찾기 제거 버튼 (★ 아이콘 또는 휴지통 아이콘)

9. 사용자가 즐겨찾기 목록 확인 및 관리

### 대체 플로우

**AF-001: 즐겨찾기가 비어있음**
- 4a. 로컬 스토리지에서 로드한 즐겨찾기 목록이 빈 배열
- 4b. 시스템이 빈 상태 UI 표시
  - 일러스트 또는 아이콘
  - "아직 즐겨찾기한 장소가 없습니다" 안내 메시지
  - "홈으로 이동" 버튼 (CTA)
- 4c. 미니 지도는 기본 위치(서울시청)로 표시
- 4d. 유스케이스 종료

**AF-002: 장소 카드 클릭**
- 9a. 사용자가 장소 카드를 클릭
- 9b. 시스템이 해당 장소의 상세 페이지로 이동 (`/place/[placeId]`)
- 9c. UC-PLACE-001(장소 상세 정보 조회) 유스케이스 시작

**AF-003: 즐겨찾기 제거 버튼 클릭**
- 9a. 사용자가 장소 카드의 즐겨찾기 제거 버튼 클릭
- 9b. UC-PLACE-003(장소 즐겨찾기 제거) 유스케이스 시작 (시나리오 B)

**AF-004: 미니 지도 마커 클릭**
- 9a. 사용자가 미니 지도의 마커 클릭
- 9b. 시스템이 해당 장소의 상세 페이지로 이동
- 9c. UC-PLACE-001(장소 상세 정보 조회) 유스케이스 시작

### 예외 플로우

**EF-001: 로컬 스토리지 비지원**
- 4a. 브라우저가 로컬 스토리지를 지원하지 않음
- 4b. 시스템이 에러 토스트 메시지 표시
  - "즐겨찾기 기능을 사용할 수 없습니다. 브라우저 설정을 확인해주세요"
- 4c. 빈 상태 UI 표시
- 4d. 유스케이스 종료

**EF-002: 로컬 스토리지 데이터 손상**
- 4a. 로컬 스토리지 데이터 파싱 중 에러 발생 (JSON.parse 실패)
- 4b. 시스템이 로컬 스토리지 초기화 (빈 배열)
- 4c. 시스템이 경고 토스트 메시지 표시
  - "즐겨찾기 데이터가 손상되어 초기화되었습니다"
- 4d. 빈 상태 UI 표시
- 4e. 유스케이스 종료

**EF-003: 장소 정보 조회 실패 (일부)**
- 5a. 일부 장소의 API 호출이 실패 (404 또는 네트워크 에러)
- 5b. 시스템이 실패한 장소에 대해 로컬 스토리지의 캐시된 정보 사용
  - `placeName`, `category`, `averageRating` (마지막 저장 시점)
- 5c. 시스템이 경고 토스트 메시지 표시
  - "일부 장소 정보를 불러올 수 없습니다. 캐시된 정보로 표시됩니다"
- 5d. 기본 플로우 7단계로 복귀

**EF-004: 장소 정보 조회 실패 (전체)**
- 5a. 모든 장소의 API 호출이 실패 (네트워크 에러)
- 5b. 시스템이 에러 토스트 메시지 표시
  - "네트워크 연결을 확인해주세요"
- 5c. 시스템이 로컬 스토리지의 캐시된 정보만으로 목록 표시
- 5d. 재시도 버튼 제공
- 5e. 사용자가 재시도 버튼 클릭 시 기본 플로우 5단계로 복귀

**EF-005: 장소가 삭제됨**
- 6a. 백엔드가 해당 `placeId`를 데이터베이스에서 찾지 못함 (404)
- 6b. 시스템이 해당 장소를 즐겨찾기 목록에서 자동 제거
- 6c. 시스템이 안내 토스트 메시지 표시
  - "일부 장소가 더 이상 존재하지 않아 즐겨찾기에서 제거되었습니다"
- 6d. 업데이트된 목록을 로컬 스토리지에 저장
- 6e. 기본 플로우 7단계로 복귀

### 비기능 요구사항

1. **성능**
   - 페이지 초기 로딩 시간: < 2초
   - 장소 정보 API 호출은 병렬로 수행되어야 함
   - 최대 100개의 즐겨찾기 항목 지원
   - 미니 지도 렌더링 시간: < 1초

2. **사용성**
   - 스켈레톤 UI로 로딩 상태를 명확히 표시
   - 장소 카드는 터치 친화적 크기 (최소 44x44px)
   - 스크롤 시 부드러운 스크롤 애니메이션 제공

3. **데이터 일관성**
   - 장소 정보는 항상 최신 데이터를 표시 (API 조회)
   - 로컬 스토리지의 캐시된 정보는 API 실패 시에만 사용
   - 삭제된 장소는 자동으로 즐겨찾기에서 제거

4. **접근성**
   - 미니 지도는 시각적 보조 수단이며, 주요 정보는 텍스트로도 제공
   - 장소 리스트는 키보드 네비게이션 가능
   - 스크린 리더를 위한 적절한 ARIA 라벨 제공

5. **반응형 디자인**
   - 모바일: 미니 지도와 리스트를 수직 배치
   - 데스크톱: 미니 지도(좌측)와 리스트(우측)를 수평 배치
   - 모든 화면 크기에서 최적화된 레이아웃 제공

---

## 시퀀스 다이어그램

### UC-PLACE-001: 장소 상세 정보 조회

```
사용자         →  프론트엔드    →  백엔드 API   →  Supabase    →  로컬 스토리지
  |                 |                |                |                |
  | 마커 클릭       |                |                |                |
  |---------------->|                |                |                |
  |                 | GET /api/places/:id             |                |
  |                 |--------------------------------->|                |
  |                 |                | SELECT * FROM places WHERE id  |
  |                 |                |--------------------------->    |
  |                 |                | 장소 데이터 반환               |
  |                 |                |<---------------------------|    |
  |                 | 장소 정보 응답 |                |                |
  |                 |<---------------------------------|                |
  |                 | GET /api/places/:id/reviews     |                |
  |                 |--------------------------------->|                |
  |                 |                | SELECT * FROM reviews WHERE... |
  |                 |                |--------------------------->    |
  |                 |                | 리뷰 데이터 반환               |
  |                 |                |<---------------------------|    |
  |                 | 리뷰 목록 응답 |                |                |
  |                 |<---------------------------------|                |
  |                 | 즐겨찾기 확인                   |                |
  |                 |------------------------------------------------->|
  |                 | 즐겨찾기 상태 반환              |                |
  |                 |<-------------------------------------------------|
  | 페이지 렌더링   |                |                |                |
  |<----------------|                |                |                |
```

### UC-PLACE-002: 장소 즐겨찾기 추가

```
사용자         →  프론트엔드    →  로컬 스토리지
  |                 |                |
  | 즐겨찾기 클릭   |                |
  |---------------->|                |
  |                 | 목록 로드      |
  |                 |--------------->|
  |                 | 현재 목록 반환 |
  |                 |<---------------|
  |                 | 중복 확인      |
  |                 | 새 항목 추가   |
  |                 | 용량 확인      |
  |                 | 목록 저장      |
  |                 |--------------->|
  |                 | 저장 완료      |
  |                 |<---------------|
  | UI 업데이트     |                |
  | (채워진 하트)   |                |
  |<----------------|                |
  | 토스트 메시지   |                |
  |<----------------|                |
```

### UC-PLACE-004: 즐겨찾기 목록 조회

```
사용자         →  프론트엔드    →  백엔드 API   →  Supabase    →  로컬 스토리지
  |                 |                |                |                |
  | 즐겨찾기 메뉴   |                |                |                |
  |---------------->|                |                |                |
  |                 | 목록 로드                      |                |
  |                 |------------------------------------------------->|
  |                 | 즐겨찾기 배열 반환             |                |
  |                 |<-------------------------------------------------|
  |                 | 각 장소 정보 조회 (병렬)       |                |
  |                 |--------------------------------->|                |
  |                 |                | SELECT * FROM places WHERE...  |
  |                 |                |--------------------------->    |
  |                 |                | 장소 데이터 반환               |
  |                 |                |<---------------------------|    |
  |                 | 장소 정보 응답 (병렬)          |                |
  |                 |<---------------------------------|                |
  |                 | 데이터 병합    |                |                |
  | 페이지 렌더링   |                |                |                |
  | (목록 + 지도)   |                |                |                |
  |<----------------|                |                |                |
```

---

## 상태 전이 다이어그램

### 즐겨찾기 상태 전이

```
┌─────────────┐
│   초기 상태  │
│ (비즐겨찾기)│
└──────┬──────┘
       │
       │ 사용자가 즐겨찾기 버튼 클릭
       │ (UC-PLACE-002)
       ↓
┌─────────────┐
│  즐겨찾기   │
│   추가 중   │
└──────┬──────┘
       │
       │ 로컬 스토리지에 저장 성공
       ↓
┌─────────────┐
│ 즐겨찾기 됨 │ ←─────────────────┐
└──────┬──────┘                    │
       │                           │
       │ 사용자가 즐겨찾기 버튼 클릭  │
       │ (UC-PLACE-003)            │
       ↓                           │
┌─────────────┐                    │
│  즐겨찾기   │                    │
│   제거 중   │                    │
└──────┬──────┘                    │
       │                           │
       │ 로컬 스토리지에서 삭제 성공   │
       ↓                           │
┌─────────────┐                    │
│   초기 상태  │                    │
│ (비즐겨찾기)│                    │
└─────────────┘                    │
                                   │
                                   │
페이지 새로고침 또는 재진입 시       │
로컬 스토리지 상태 확인 ─────────────┘
```

---

## 데이터 모델

### 로컬 스토리지 구조

**키**: `mafia-favorites`

**값 (JSON 배열)**:
```typescript
interface Favorite {
  placeId: string;           // UUID, 장소 고유 ID
  placeName: string;         // 장소명 (예: "맛있는 한식당")
  category: string;          // 카테고리 (예: "한식")
  averageRating: number;     // 평균 평점 (0.0 - 5.0)
  addedAt: string;           // 추가 일시 (ISO 8601 형식)
}
```

**예시**:
```json
[
  {
    "placeId": "123e4567-e89b-12d3-a456-426614174000",
    "placeName": "맛있는 한식당",
    "category": "한식",
    "averageRating": 4.5,
    "addedAt": "2025-10-21T05:30:00.000Z"
  },
  {
    "placeId": "223e4567-e89b-12d3-a456-426614174001",
    "placeName": "신선한 초밥집",
    "category": "일식",
    "averageRating": 4.8,
    "addedAt": "2025-10-20T12:15:00.000Z"
  }
]
```

### API 응답 구조

**장소 상세 정보 (GET /api/places/:id)**:
```typescript
interface PlaceDetailResponse {
  success: true;
  data: {
    id: string;              // UUID
    name: string;            // 장소명
    address: string;         // 도로명 주소
    category: string;        // 카테고리
    latitude: number;        // 위도
    longitude: number;       // 경도
    telephone: string | null; // 전화번호
    averageRating: number;   // 평균 평점 (0.0 - 5.0)
    reviewCount: number;     // 리뷰 수
    createdAt: string;       // 생성일시 (ISO 8601)
  };
}
```

---

## 에러 코드 정의

| 에러 코드 | HTTP 상태 | 설명 | 사용자 메시지 |
|-----------|-----------|------|---------------|
| PLACE_NOT_FOUND | 404 | 장소가 데이터베이스에 존재하지 않음 | "장소를 찾을 수 없습니다" |
| NETWORK_ERROR | - | 네트워크 연결 실패 | "네트워크 연결을 확인해주세요" |
| SERVER_ERROR | 500 | 서버 내부 오류 | "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요" |
| TIMEOUT_ERROR | 408 | 요청 타임아웃 | "요청 시간이 초과되었습니다. 다시 시도해주세요" |
| STORAGE_UNAVAILABLE | - | 로컬 스토리지 사용 불가 | "즐겨찾기 기능을 사용할 수 없습니다. 브라우저 설정을 확인해주세요" |
| STORAGE_QUOTA_EXCEEDED | - | 로컬 스토리지 용량 초과 | "저장 공간이 부족합니다. 일부 즐겨찾기를 삭제해주세요" |
| ALREADY_FAVORITED | - | 이미 즐겨찾기에 추가된 장소 | "이미 즐겨찾기에 추가된 장소입니다" |
| NOT_FAVORITED | - | 즐겨찾기에 없는 장소 제거 시도 | "즐겨찾기에 없는 장소입니다" |
| DATA_CORRUPTED | - | 로컬 스토리지 데이터 손상 | "즐겨찾기 데이터가 손상되어 초기화되었습니다" |

---

## 테스트 시나리오

### UC-PLACE-001 테스트 케이스

| TC ID | 테스트 케이스 | 사전 조건 | 입력 | 예상 결과 |
|-------|---------------|-----------|------|-----------|
| TC-001-001 | 정상적인 장소 상세 조회 | 장소가 DB에 존재, 리뷰 10개 | placeId: valid-uuid | 장소 정보 및 리뷰 10개 표시 |
| TC-001-002 | 리뷰가 없는 장소 조회 | 장소가 DB에 존재, 리뷰 0개 | placeId: valid-uuid | 장소 정보 표시, 빈 상태 UI |
| TC-001-003 | 존재하지 않는 장소 조회 | 장소가 DB에 없음 | placeId: invalid-uuid | 404 에러 페이지 표시 |
| TC-001-004 | 즐겨찾기된 장소 조회 | 장소가 즐겨찾기에 있음 | placeId: valid-uuid | 즐겨찾기 버튼이 채워진 하트 |
| TC-001-005 | 네트워크 에러 발생 | 네트워크 단절 | placeId: valid-uuid | 네트워크 에러 메시지, 재시도 버튼 |

### UC-PLACE-002 테스트 케이스

| TC ID | 테스트 케이스 | 사전 조건 | 입력 | 예상 결과 |
|-------|---------------|-----------|------|-----------|
| TC-002-001 | 정상적인 즐겨찾기 추가 | 즐겨찾기 목록 0개 | 즐겨찾기 버튼 클릭 | 즐겨찾기 추가, 토스트 메시지 |
| TC-002-002 | 중복 즐겨찾기 추가 시도 | 이미 즐겨찾기에 추가됨 | 즐겨찾기 버튼 클릭 | 에러 메시지 표시 |
| TC-002-003 | 100개 제한 도달 시 추가 | 즐겨찾기 목록 100개 | 즐겨찾기 버튼 클릭 | 가장 오래된 항목 제거, 새 항목 추가 |
| TC-002-004 | 로컬 스토리지 비지원 | 사생활 보호 모드 | 즐겨찾기 버튼 클릭 | 에러 메시지 표시 |
| TC-002-005 | 로컬 스토리지 용량 초과 | 스토리지 거의 가득 참 | 즐겨찾기 버튼 클릭 | 용량 초과 에러 메시지 |

### UC-PLACE-003 테스트 케이스

| TC ID | 테스트 케이스 | 사전 조건 | 입력 | 예상 결과 |
|-------|---------------|-----------|------|-----------|
| TC-003-001 | 장소 상세 페이지에서 제거 | 즐겨찾기에 추가됨 | 즐겨찾기 버튼 클릭 | 즐겨찾기 제거, 빈 하트 아이콘 |
| TC-003-002 | 즐겨찾기 목록에서 제거 | 즐겨찾기 목록 5개 | 제거 버튼 클릭 | 카드 제거, 목록 4개로 감소 |
| TC-003-003 | 마지막 항목 제거 | 즐겨찾기 목록 1개 | 제거 버튼 클릭 | 빈 상태 UI 표시 |
| TC-003-004 | 존재하지 않는 항목 제거 | 즐겨찾기에 없음 | 제거 버튼 클릭 | 에러 메시지, 버튼 상태 동기화 |

### UC-PLACE-004 테스트 케이스

| TC ID | 테스트 케이스 | 사전 조건 | 입력 | 예상 결과 |
|-------|---------------|-----------|------|-----------|
| TC-004-001 | 정상적인 목록 조회 | 즐겨찾기 목록 5개 | 즐겨찾기 메뉴 클릭 | 5개 장소 카드 표시, 미니 지도 렌더링 |
| TC-004-002 | 빈 목록 조회 | 즐겨찾기 목록 0개 | 즐겨찾기 메뉴 클릭 | 빈 상태 UI 표시 |
| TC-004-003 | 일부 장소 정보 조회 실패 | 일부 장소 삭제됨 | 즐겨찾기 메뉴 클릭 | 캐시된 정보 표시, 경고 메시지 |
| TC-004-004 | 전체 장소 정보 조회 실패 | 네트워크 단절 | 즐겨찾기 메뉴 클릭 | 캐시된 정보 표시, 재시도 버튼 |
| TC-004-005 | 장소 카드 클릭 | 즐겨찾기 목록 5개 | 첫 번째 카드 클릭 | 장소 상세 페이지로 이동 |
| TC-004-006 | 미니 지도 마커 클릭 | 즐겨찾기 목록 5개 | 마커 클릭 | 장소 상세 페이지로 이동 |

---

## 관련 문서

- [사용자 플로우](/docs/userflow.md) - 전체 사용자 플로우 정의
- [PRD](/docs/prd.md) - 프로덕트 요구사항 명세
- [요구사항 명세서](/docs/requirement.md) - 기능 요구사항 상세
- [데이터베이스 스키마](/docs/database.md) - 데이터베이스 ERD 및 스키마

---

## 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0.0 | 2025-10-21 | Development Team | 초안 작성 - 장소 관리 기능 유스케이스 정의 |

---

**문서 끝**
