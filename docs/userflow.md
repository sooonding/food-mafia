# 맛집 지도 서비스 - 사용자 플로우 문서

## 개요

이 문서는 맛집 지도 서비스의 사용자 플로우를 상세하게 정의합니다. 본 서비스는 비로그인 상태로도 모든 기능을 이용할 수 있으며, 네이버 API를 활용한 장소 검색과 리뷰 작성을 지원합니다.

---

## 1. 홈 페이지 ("/")

### 1.1 초기 진입

**사용자 액션:**
- 사용자가 홈페이지에 처음 접속

**시스템 동작:**
1. 헤더 영역 렌더링 (로고, 검색바)
2. 지도 컴포넌트 초기화 (네이버 지도 API)
3. 현재 위치 권한 요청
4. 카테고리 필터바 렌더링
5. 지도 영역 내 리뷰가 있는 장소 마커 로딩 (보이는 영역만)

**화면 구성:**
- 헤더 (로고, 검색바)
- 지도 (네이버맵) - 전체 화면 또는 주요 영역
- 필터바 (카테고리 필터: 한식, 일식, 양식 등)
- 플로팅 버튼 (현재 위치, 리스트 보기)

**상태:**
- 로딩 상태: 지도 초기화 및 마커 데이터 로딩 중 스켈레톤 UI 표시
- 에러 상태: 위치 권한 거부 시 토스트 메시지 표시

---

### 1.2 장소 검색

**사용자 액션:**
- 헤더의 검색바 클릭 또는 포커스

**시스템 동작:**
1. 검색 모달 또는 드로어 열기
2. 최근 검색어 목록 표시 (로컬 스토리지에서 로드, 최대 10개)
3. 검색어 입력 대기

**검색어 입력 플로우:**

**사용자 액션:**
- 검색어 입력 (실시간)

**시스템 동작:**
1. 디바운싱 적용 (300ms)
2. 네이버 로컬 검색 API 호출
3. 검색 결과 리스트 렌더링
   - 장소명
   - 주소
   - 카테고리
   - 거리 (현재 위치 기준)
4. 정렬 옵션 제공 (거리순, 평점순)

**검색 결과 선택:**

**사용자 액션:**
- 검색 결과 항목 클릭

**시스템 동작:**
1. 검색어를 최근 검색어에 추가 (로컬 스토리지)
2. 지도를 해당 위치로 이동
3. 해당 장소 마커 강조 표시
4. 장소 상세 모달 열기 (또는 페이지 이동)
5. 검색 모달/드로어 닫기

**예외 상황:**
- 검색 결과 없음: "검색 결과가 없습니다" 안내 메시지 표시
- API 에러: 토스트 메시지로 에러 안내

---

### 1.3 지도 내비게이션

**사용자 액션:**
- 지도 드래그, 줌인/줌아웃

**시스템 동작:**
1. 지도 이동 완료 후 새로운 영역 범위 계산
2. 해당 영역 내 리뷰가 있는 장소 데이터 요청
3. 기존 마커 제거 및 새 마커 렌더링
4. 마커 클러스터링 적용 (동일 영역에 여러 마커가 있을 경우)

**마커 표시 규칙:**
- 카테고리별 아이콘 구분
  - 한식: 밥 아이콘
  - 일식: 초밥 아이콘
  - 양식: 스테이크 아이콘
  - 중식: 해당 아이콘
  - 카페: 커피 아이콘
  - 기타: 기본 마커

**성능 최적화:**
- 보이는 영역만 데이터 로딩
- 마커 클러스터링 적용
- 디바운싱으로 과도한 API 호출 방지

---

### 1.4 마커 클릭

**사용자 액션:**
- 지도 내 마커 클릭

**시스템 동작:**
1. 장소 상세 페이지로 이동 (`/place/[placeId]`)
   - 또는 모달 형태로 표시 (디자인 결정에 따라)

---

### 1.5 카테고리 필터링

**사용자 액션:**
- 필터바에서 카테고리 선택/해제

**시스템 동작:**
1. 선택된 카테고리 상태 업데이트
2. 현재 지도 영역 내 필터링된 카테고리의 마커만 표시
3. 마커 재렌더링

**카테고리 옵션:**
- 전체
- 한식
- 일식
- 양식
- 중식
- 카페
- 기타

---

### 1.6 현재 위치로 이동

**사용자 액션:**
- 현재 위치 버튼 클릭

**시스템 동작:**
1. 위치 권한 확인
2. 권한이 있을 경우: 현재 위치 좌표 획득
3. 지도를 현재 위치로 이동 (애니메이션)
4. 현재 위치 마커 표시

**예외 상황:**
- 위치 권한 거부: "위치 권한이 필요합니다" 토스트 메시지
- 위치 획득 실패: "위치를 가져올 수 없습니다" 토스트 메시지

---

## 2. 장소 상세 페이지 ("/place/[placeId]")

### 2.1 페이지 진입

**진입 경로:**
- 홈 페이지에서 마커 클릭
- 검색 결과에서 장소 선택
- 즐겨찾기 목록에서 장소 선택

**시스템 동작:**
1. 장소 ID로 장소 정보 조회
2. 해당 장소의 리뷰 목록 조회 (첫 페이지, 최신순)
3. 평균 평점 계산
4. 페이지 렌더링

**화면 구성:**
- 장소 정보 섹션
  - 장소명
  - 주소
  - 카테고리
  - 평균 평점 (별점 시각화)
  - 리뷰 수
- 액션 버튼 영역
  - 리뷰 작성 버튼
  - 즐겨찾기 버튼
  - 길찾기 버튼
  - 공유 버튼
  - 뒤로가기 버튼
- 리뷰 목록 섹션
  - 정렬 옵션 (최신순, 평점순)
  - 리뷰 카드 목록 (무한 스크롤)

**상태:**
- 로딩 상태: 스켈레톤 UI 표시
- 에러 상태: 장소를 찾을 수 없는 경우 에러 페이지 표시
- 빈 상태: 리뷰가 없는 경우 "아직 리뷰가 없습니다" 안내 메시지

---

### 2.2 리뷰 목록 조회

**시스템 동작:**
1. 선택된 정렬 옵션에 따라 리뷰 목록 조회
2. 무한 스크롤로 추가 리뷰 로딩

**리뷰 카드 구성:**
- 작성자명
- 평점 (별점)
- 리뷰 내용
- 방문 날짜 (선택 사항)
- 작성 날짜
- 수정/삭제 버튼 (조건부 표시)

**정렬 옵션:**
- 최신순 (기본)
- 평점순 (높은 순)

---

### 2.3 리뷰 수정/삭제

**사용자 액션:**
- 리뷰 카드의 수정 또는 삭제 버튼 클릭

**시스템 동작 (비밀번호 확인 모달 표시):**
1. 비밀번호 입력 모달 열기
2. 사용자 비밀번호 입력

**비밀번호 확인 후:**

**수정 플로우:**
- 비밀번호 일치: 리뷰 수정 페이지로 이동 (`/place/[placeId]/review/[reviewId]/edit`)
- 비밀번호 불일치: "비밀번호가 일치하지 않습니다" 에러 메시지

**삭제 플로우:**
- 비밀번호 일치: 삭제 확인 다이얼로그 표시
  - 사용자 확인: 리뷰 삭제 API 호출
  - 삭제 성공: 토스트 메시지 표시, 리뷰 목록 갱신
  - 해당 장소의 리뷰가 0개가 된 경우: 지도에서 마커 자동 제거
- 비밀번호 불일치: "비밀번호가 일치하지 않습니다" 에러 메시지

---

### 2.4 즐겨찾기 추가/제거

**사용자 액션:**
- 즐겨찾기 버튼 클릭

**시스템 동작:**
1. 로컬 스토리지에서 즐겨찾기 목록 확인
2. 현재 장소가 즐겨찾기에 있는지 확인
3. 즐겨찾기 추가/제거 토글
4. 로컬 스토리지에 저장
5. 버튼 상태 업데이트 (채워진 하트 / 빈 하트)
6. 토스트 메시지 표시 ("즐겨찾기에 추가되었습니다" / "즐겨찾기에서 제거되었습니다")

---

### 2.5 길찾기

**사용자 액션:**
- 길찾기 버튼 클릭

**시스템 동작:**
1. 네이버 지도 앱 또는 카카오맵 앱으로 딥링크 연결
2. 모바일: 앱 실행 또는 웹으로 열기
3. 데스크톱: 새 탭에서 네이버 지도 길찾기 페이지 열기

---

### 2.6 공유

**사용자 액션:**
- 공유 버튼 클릭

**시스템 동작:**
1. 공유 옵션 바텀 시트 또는 모달 표시
2. Web Share API 지원 여부 확인
   - 지원: 네이티브 공유 시트 열기
   - 미지원: 링크 복사 옵션 제공
3. 링크 복사 시: 클립보드에 현재 페이지 URL 복사, 토스트 메시지 표시

---

## 3. 리뷰 작성 페이지 ("/place/[placeId]/review/new")

### 3.1 페이지 진입

**진입 경로:**
- 장소 상세 페이지에서 "리뷰 작성" 버튼 클릭

**시스템 동작:**
1. 장소 ID로 장소 정보 조회
2. 리뷰 작성 폼 렌더링

**화면 구성:**
- 장소 정보 요약 (고정 헤더)
  - 장소명
  - 주소
- 리뷰 작성 폼
  - 작성자명 입력 (2~10자)
  - 평점 선택 (별점 1~5)
  - 리뷰 내용 입력 (텍스트 에어리어, 10~500자)
  - 방문 날짜 선택 (선택 사항)
  - 비밀번호 입력 (4~20자, 수정/삭제 시 사용)
  - 작성하기 버튼

---

### 3.2 리뷰 작성

**사용자 액션:**
- 폼 필드 작성 및 "작성하기" 버튼 클릭

**유효성 검증:**
1. 작성자명: 2~10자 (필수)
2. 평점: 1~5 (필수)
3. 리뷰 내용: 10~500자 (필수)
4. 비밀번호: 4~20자 (필수)
5. 방문 날짜: 유효한 날짜 형식 (선택)

**시스템 동작:**
1. 클라이언트 측 유효성 검증
2. 유효성 통과 시: 리뷰 작성 API 호출
3. 비밀번호 bcrypt 해싱 (서버 측)
4. XSS 방지를 위한 입력값 sanitization (서버 측)
5. 장소가 DB에 없는 경우: 장소 자동 생성 (네이버 API에서 정보 가져오기)
6. 리뷰 저장 완료

**성공 시:**
- 토스트 메시지 표시 ("리뷰가 작성되었습니다")
- 장소 상세 페이지로 리다이렉트
- 새 리뷰가 목록에 표시됨

**실패 시:**
- 유효성 검증 실패: 해당 필드에 에러 메시지 표시
- 서버 에러: 토스트 메시지로 에러 안내

---

## 4. 리뷰 수정 페이지 ("/place/[placeId]/review/[reviewId]/edit")

### 4.1 페이지 진입

**진입 경로:**
- 장소 상세 페이지에서 리뷰 수정 버튼 클릭 후 비밀번호 확인

**시스템 동작:**
1. 리뷰 ID로 리뷰 정보 조회
2. 기존 리뷰 내용을 폼에 자동 입력
3. 리뷰 수정 폼 렌더링

**화면 구성:**
- 리뷰 작성 페이지와 동일
- 기존 내용이 입력된 상태

---

### 4.2 리뷰 수정

**사용자 액션:**
- 폼 필드 수정 및 "수정하기" 버튼 클릭

**유효성 검증:**
- 리뷰 작성과 동일한 유효성 검증 규칙 적용

**시스템 동작:**
1. 클라이언트 측 유효성 검증
2. 유효성 통과 시: 리뷰 수정 API 호출
3. 비밀번호 재확인 (서버 측)
4. XSS 방지를 위한 입력값 sanitization (서버 측)
5. 리뷰 업데이트

**성공 시:**
- 토스트 메시지 표시 ("리뷰가 수정되었습니다")
- 장소 상세 페이지로 리다이렉트
- 수정된 리뷰가 목록에 표시됨

**실패 시:**
- 비밀번호 불일치: "비밀번호가 일치하지 않습니다" 에러 메시지
- 유효성 검증 실패: 해당 필드에 에러 메시지 표시
- 서버 에러: 토스트 메시지로 에러 안내

---

## 5. 즐겨찾기 목록 페이지 ("/my-places")

### 5.1 페이지 진입

**진입 경로:**
- 헤더 또는 네비게이션에서 "즐겨찾기" 메뉴 클릭

**시스템 동작:**
1. 로컬 스토리지에서 즐겨찾기 목록 로드
2. 각 장소의 상세 정보 조회 (장소명, 주소, 카테고리, 평균 평점, 리뷰 수)
3. 페이지 렌더링

**화면 구성:**
- 헤더 (제목: "즐겨찾기")
- 미니 지도 (저장한 장소 마커 표시)
- 장소 리스트
  - 장소 카드 (장소명, 주소, 카테고리, 평균 평점, 리뷰 수)
  - 즐겨찾기 제거 버튼

**상태:**
- 로딩 상태: 스켈레톤 UI 표시
- 빈 상태: "아직 즐겨찾기한 장소가 없습니다" 안내 메시지

---

### 5.2 장소 선택

**사용자 액션:**
- 장소 카드 클릭

**시스템 동작:**
- 장소 상세 페이지로 이동 (`/place/[placeId]`)

---

### 5.3 즐겨찾기 제거

**사용자 액션:**
- 즐겨찾기 제거 버튼 클릭

**시스템 동작:**
1. 확인 다이얼로그 표시 (선택 사항)
2. 사용자 확인 시: 로컬 스토리지에서 해당 장소 제거
3. 목록에서 해당 장소 카드 제거
4. 미니 지도 마커 업데이트
5. 토스트 메시지 표시 ("즐겨찾기에서 제거되었습니다")

---

## 6. 공통 사용자 플로우

### 6.1 에러 처리

**API 에러:**
- 네트워크 에러: "네트워크 연결을 확인해주세요" 토스트 메시지
- 서버 에러 (5xx): "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요" 토스트 메시지
- 클라이언트 에러 (4xx): 해당 에러 메시지 토스트로 표시

**유효성 검증 에러:**
- 실시간 유효성 검증 (입력 중)
- 필드별 에러 메시지 표시 (입력 필드 하단에 빨간색 텍스트)

---

### 6.2 로딩 상태

**페이지 로딩:**
- 스켈레톤 UI 표시 (장소 상세, 리뷰 목록 등)

**버튼 로딩:**
- 버튼 비활성화 및 로딩 인디케이터 표시
- 예: "작성하기" → "작성 중..."

**지도 로딩:**
- 지도 영역에 로딩 스피너 표시

---

### 6.3 빈 상태

**리뷰 없음:**
- "아직 리뷰가 없습니다. 첫 번째 리뷰를 작성해보세요!" 안내 메시지
- 리뷰 작성 버튼 CTA

**검색 결과 없음:**
- "검색 결과가 없습니다" 안내 메시지

**즐겨찾기 없음:**
- "아직 즐겨찾기한 장소가 없습니다" 안내 메시지
- 홈으로 이동 버튼 CTA

---

### 6.4 모바일 반응형

**모바일 우선 디자인:**
- 터치 친화적인 버튼 크기
- 바텀 시트 또는 드로어 UI 활용
- 스와이프 제스처 지원 (모달 닫기 등)

**데스크톱:**
- 지도와 리스트 양분할 레이아웃
- 마우스 호버 인터랙션

---

## 7. 주요 기능 목록 (usecase-writer 참조용)

### 7.1 장소 검색 및 탐색
- 장소 검색 (네이버 API)
- 지도에서 장소 탐색
- 카테고리별 필터링
- 현재 위치 기반 탐색

### 7.2 리뷰 관리
- 리뷰 작성
- 리뷰 조회
- 리뷰 수정 (비밀번호 인증)
- 리뷰 삭제 (비밀번호 인증)

### 7.3 장소 관리
- 장소 상세 정보 조회
- 장소 즐겨찾기 추가/제거
- 즐겨찾기 목록 조회

### 7.4 지도 기능
- 지도 내비게이션 (드래그, 줌)
- 마커 표시 (카테고리별 아이콘)
- 마커 클러스터링
- 현재 위치로 이동

### 7.5 공유 및 유틸리티
- 장소 공유 (링크 복사, Web Share API)
- 길찾기 (네이버 지도 연동)
- 최근 검색어 관리

### 7.6 보안 및 검증
- 비밀번호 bcrypt 해싱
- XSS 방지 (입력값 sanitization)
- 유효성 검증 (클라이언트 및 서버)

### 7.7 성능 최적화
- 지도 영역 기반 데이터 로딩
- 마커 클러스터링
- 검색어 입력 디바운싱 (300ms)
- 무한 스크롤 (리뷰 목록)

---

## 8. 상태 전환 다이어그램

### 8.1 리뷰 작성 플로우

```
장소 상세 페이지
    ↓ (리뷰 작성 버튼 클릭)
리뷰 작성 페이지
    ↓ (폼 작성)
유효성 검증
    ↓ (성공)
API 호출
    ↓ (성공)
장소 상세 페이지 (리뷰 추가됨)
    ↓ (리뷰가 첫 리뷰인 경우)
지도에 마커 추가
```

### 8.2 리뷰 수정/삭제 플로우

```
장소 상세 페이지
    ↓ (수정/삭제 버튼 클릭)
비밀번호 확인 모달
    ↓ (비밀번호 입력)
비밀번호 검증
    ↓ (성공)
[수정] 리뷰 수정 페이지 → 폼 수정 → API 호출 → 장소 상세 페이지
[삭제] 삭제 확인 다이얼로그 → API 호출 → 장소 상세 페이지 (리뷰 제거됨)
    ↓ (리뷰가 0개가 된 경우)
지도에서 마커 제거
```

### 8.3 검색 플로우

```
홈 페이지
    ↓ (검색바 클릭)
검색 모달/드로어 열기
    ↓ (검색어 입력)
디바운싱 (300ms)
    ↓
네이버 API 호출
    ↓
검색 결과 리스트 표시
    ↓ (검색 결과 선택)
지도 이동 + 마커 강조
    ↓
장소 상세 모달/페이지
```

### 8.4 즐겨찾기 플로우

```
장소 상세 페이지
    ↓ (즐겨찾기 버튼 클릭)
로컬 스토리지 확인
    ↓
[추가] 로컬 스토리지에 저장 → 버튼 상태 업데이트 (채워진 하트)
[제거] 로컬 스토리지에서 제거 → 버튼 상태 업데이트 (빈 하트)
    ↓
토스트 메시지 표시
```

---

## 9. 예외 상황 처리

### 9.1 네트워크 에러
- 재시도 버튼 제공
- 오프라인 감지 시 안내 메시지 표시

### 9.2 권한 에러
- 위치 권한 거부: 수동으로 위치 입력 또는 검색 유도
- 클립보드 권한 거부: 수동으로 링크 복사 안내

### 9.3 데이터 무결성
- 장소 삭제 시 리뷰 cascade 삭제 (또는 orphan 처리)
- 리뷰 삭제 시 평균 평점 재계산

### 9.4 사용자 입력 에러
- 유효하지 않은 비밀번호: 재입력 유도
- 유효성 검증 실패: 명확한 에러 메시지 및 필드 강조

---

## 10. 접근성 (Accessibility)

### 10.1 키보드 내비게이션
- 모든 인터랙티브 요소 키보드 접근 가능
- 포커스 상태 명확히 표시

### 10.2 스크린 리더
- 의미 있는 alt 텍스트
- ARIA 라벨 적용

### 10.3 색상 대비
- WCAG AA 기준 준수

---

이 문서는 맛집 지도 서비스의 모든 사용자 플로우를 정의하며, 각 기능의 상세 유스케이스 작성 시 참조 문서로 활용됩니다.
